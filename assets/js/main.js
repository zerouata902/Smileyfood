/**
* Template Name: Yummy
* Template URL: https://bootstrapmade.com/yummy-bootstrap-restaurant-website-template/
* Updated: Aug 07 2024 with Bootstrap v5.3.3
* Author: BootstrapMade.com
* License: https://bootstrapmade.com/license/
*/

(function() {
  "use strict";

  /**
   * Apply .scrolled class to the body as the page is scrolled down
   */
  function toggleScrolled() {
    const selectBody = document.querySelector('body');
    const selectHeader = document.querySelector('#header');
    if (!selectHeader.classList.contains('scroll-up-sticky') && !selectHeader.classList.contains('sticky-top') && !selectHeader.classList.contains('fixed-top')) return;
    window.scrollY > 100 ? selectBody.classList.add('scrolled') : selectBody.classList.remove('scrolled');
  }

  document.addEventListener('scroll', toggleScrolled);
  window.addEventListener('load', toggleScrolled);

  /**
   * Mobile nav toggle
   */
  const mobileNavToggleBtn = document.querySelector('.mobile-nav-toggle');

  function mobileNavToogle() {
    document.querySelector('body').classList.toggle('mobile-nav-active');
    mobileNavToggleBtn.classList.toggle('bi-list');
    mobileNavToggleBtn.classList.toggle('bi-x');
  }
  mobileNavToggleBtn.addEventListener('click', mobileNavToogle);

  /**
   * Hide mobile nav on same-page/hash links
   */
  document.querySelectorAll('#navmenu a').forEach(navmenu => {
    navmenu.addEventListener('click', () => {
      if (document.querySelector('.mobile-nav-active')) {
        mobileNavToogle();
      }
    });

  });

  /**
   * Toggle mobile nav dropdowns
   */
  document.querySelectorAll('.navmenu .toggle-dropdown').forEach(navmenu => {
    navmenu.addEventListener('click', function(e) {
      e.preventDefault();
      this.parentNode.classList.toggle('active');
      this.parentNode.nextElementSibling.classList.toggle('dropdown-active');
      e.stopImmediatePropagation();
    });
  });


   
  let scrollTop = document.querySelector('.scroll-top');

  function toggleScrollTop() {
    if (scrollTop) {
      window.scrollY > 100 ? scrollTop.classList.add('active') : scrollTop.classList.remove('active');
    }
  }
  scrollTop.addEventListener('click', (e) => {
    e.preventDefault();
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });

  window.addEventListener('load', toggleScrollTop);
  document.addEventListener('scroll', toggleScrollTop);

  /**
   * Animation on scroll function and init
   */
  function aosInit() {
    AOS.init({
      duration: 600,
      easing: 'ease-in-out',
      once: true,
      mirror: false
    });
  }
  window.addEventListener('load', aosInit);

  /**
   * Initiate glightbox
   */
  const glightbox = GLightbox({
    selector: '.glightbox'
  });
  
  const lightboxSingle = GLightbox({
  selector: '.glightbox-single'
});

  /**
   * Initiate Pure Counter
   */
  new PureCounter();

  /**
   * Init swiper sliders
   */
  function initSwiper() {
    document.querySelectorAll(".init-swiper").forEach(function(swiperElement) {
      let config = JSON.parse(
        swiperElement.querySelector(".swiper-config").innerHTML.trim()
      );

      if (swiperElement.classList.contains("swiper-tab")) {
        initSwiperWithCustomPagination(swiperElement, config);
      } else {
        new Swiper(swiperElement, config);
      }
    });
  }

  window.addEventListener("load", initSwiper);

  /**
   * Correct scrolling position upon page load for URLs containing hash links.
   */
  window.addEventListener('load', function(e) {
    if (window.location.hash) {
      if (document.querySelector(window.location.hash)) {
        setTimeout(() => {
          let section = document.querySelector(window.location.hash);
          let scrollMarginTop = getComputedStyle(section).scrollMarginTop;
          window.scrollTo({
            top: section.offsetTop - parseInt(scrollMarginTop),
            behavior: 'smooth'
          });
        }, 100);
      }
    }
  });

  /**
   * Navmenu Scrollspy
   */
  let navmenulinks = document.querySelectorAll('.navmenu a');

  function navmenuScrollspy() {
    navmenulinks.forEach(navmenulink => {
      if (!navmenulink.hash) return;
      let section = document.querySelector(navmenulink.hash);
      if (!section) return;
      let position = window.scrollY + 200;
      if (position >= section.offsetTop && position <= (section.offsetTop + section.offsetHeight)) {
        document.querySelectorAll('.navmenu a.active').forEach(link => link.classList.remove('active'));
        navmenulink.classList.add('active');
      } else {
        navmenulink.classList.remove('active');
      }
    })
  }
  window.addEventListener('load', navmenuScrollspy);
  document.addEventListener('scroll', navmenuScrollspy);

})();

let cart = [];
let selectedLatLng = null;
let restaurantLatLng = [34.262341,-6.589373];
let map, customerMarker;

// âœ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©
function addToCart(name, price, image) {
  let item = cart.find(i => i.name === name);
  if (item) {
    item.qty += 1;
  } else {
    cart.push({ name, price, image, qty: 1 });
  }
  updateTotal();
  showCartBar();
}

// âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ùˆ Ø§Ù„Ø¨Ø§Ø¯Ø¬
function updateTotal() {
  const total = cart.reduce((sum, i) => sum + i.price * i.qty, 0);
  document.getElementById("total").innerText = "Total: " + total + " DH";

  const cartBadge = document.getElementById("cart-count");
  const totalItems = cart.reduce((sum, i) => sum + i.qty, 0);

  if (totalItems > 0) {
    cartBadge.textContent = totalItems;
    cartBadge.style.display = "inline-block";
  } else {
    cartBadge.style.display = "none";
  }
}

// âœ… Ø¥Ø¸Ù‡Ø§Ø± cart-bar ÙÙ‚Ø· Ø¥Ù„Ø§ ÙƒØ§Ù† ÙÙŠÙ‡ Ø¹Ù†Ø§ØµØ± + Ø§Ù‡ØªØ²Ø§Ø²
function showCartBar() {
  const cartBar = document.querySelector(".cart-bar");
  if (cart.length > 0) {
    cartBar.style.display = "flex";

    // âœ… ØªÙ‡ØªØ² Ø´ÙˆÙŠØ©
    cartBar.classList.add("shake");
    setTimeout(() => {
      cartBar.classList.remove("shake");
    }, 500);
  } else {
    cartBar.style.display = "none";
  }
}

// âœ… ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø©
function goToCartPage() {
  if (cart.length === 0) {
    alert("ğŸ›’ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
    return;
  }

  document.getElementById("cart-page").style.display = "block";
  showCartItems();
}

// âœ… Ø¥ØºÙ„Ø§Ù‚ ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø©
function closeCart() {
  document.getElementById("cart-page").style.display = "none";
}

// âœ… Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù„Ø©
function showCartItems() {
  const container = document.getElementById("cart-items");
  container.innerHTML = "";

  cart.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "cart-item";
    div.innerHTML = `
      <img src="${item.image}">
      <div class="info">
        <strong>${item.name} Ã—${item.qty}</strong>
        <p>${item.price * item.qty} DH</p>
        <div class="qty-controls">
          <button onclick="changeQty(${index}, 1)">+</button>
          <button onclick="changeQty(${index}, -1)">-</button>
          <button onclick="removeItem(${index})">ğŸ—‘ï¸</button>
        </div>
      </div>`;
    container.appendChild(div);
  });

  updateTotal();
}

// âœ… ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©
function changeQty(index, delta) {
  cart[index].qty += delta;
  if (cart[index].qty <= 0) cart.splice(index, 1);
  showCartItems();
  updateTotal();
  showCartBar();
}

// âœ… Ø­Ø°Ù Ø¹Ù†ØµØ±
function removeItem(index) {
  cart.splice(index, 1);
  showCartItems();
  updateTotal();
  showCartBar();
}

// âœ… Ø¹Ø±Ø¶ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø­Ù„ÙŠ Ø£Ùˆ ØªÙˆØµÙŠÙ„)
function showOrderOptions() {
  if (cart.length === 0) {
    alert("ğŸ›’ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
    return;
  }
  document.getElementById("order-options").style.display = "block";
}

// âœ… Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨
function selectOption(type) {
  if (cart.length === 0) {
    alert("ğŸ›’ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
    return;
  }

  document.getElementById("order-options").style.display = "none";
  document.getElementById("order-button").style.display = "none";

  if (type === "delivery") {
    document.getElementById("map-container").style.display = "block";
    initMap();
  } else {
    document.getElementById("map-container").style.display = "none";
    sendWhatsAppOrder();
  }
}

// ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ù„ØªÙˆØµÙŠÙ„
const deliveryRadius = 5700; // Ø¨Ø§Ù„Ù…ØªØ±

function getDistance(latlng1, latlng2) {
  const R = 6371000;
  const toRad = deg => deg * Math.PI / 180;
  const dLat = toRad(latlng2.lat - latlng1.lat);
  const dLng = toRad(latlng2.lng - latlng1.lng);
  const lat1 = toRad(latlng1.lat);
  const lat2 = toRad(latlng2.lat);

  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1) * Math.cos(lat2) *
            Math.sin(dLng/2) * Math.sin(dLng/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  const d = R * c;
  return d;
}


// âœ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙˆØµÙŠÙ„ ÙÙ‚Ø·
function initMap() {
  if (window.mapInitialized) return;
  window.mapInitialized = true;

  map = L.map('map').setView(restaurantLatLng, 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø·Ø¹Ù… (Ø¯Ø§Ø¦Ø±ÙŠØ© Ø¨Ø§Ù„ØµÙˆØ±Ø©)
  const restaurantIcon = L.divIcon({
    html: '<div class="restaurant-icon"><img src="assets/img/Logo22.png" alt="Restaurant"></div>',
    className: '',
    iconSize: [50, 50],
    iconAnchor: [25, 50]
  });

  L.marker(restaurantLatLng, { icon: restaurantIcon })
    .addTo(map)
    .bindPopup("ğŸ“ Ù…Ù† ÙØ¶Ù„Ùƒ Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø¯Ù‚Ø©")
    .openPopup();

  // Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„ØªÙˆØµÙŠÙ„
  L.circle(restaurantLatLng, {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.2,
    radius: deliveryRadius
  }).addTo(map);

  // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø²Ø¨ÙˆÙ† (Font Awesome Ø±Ø¬Ù„ ÙˆØ§Ù‚Ù)
  const customerIcon = L.divIcon({
    html: '<div class="customer-icon"><i class="fas fa-male"></i></div>',
    className: '',
    iconSize: [40, 40],
    iconAnchor: [20, 40]
  });

  // Ø­Ø¯Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  map.on("click", function (e) {
    const dist = getDistance(e.latlng, { lat: restaurantLatLng[0], lng: restaurantLatLng[1] });
    if (dist > deliveryRadius) {
      alert("ğŸ›‘ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„");
      return;
    }

    selectedLatLng = e.latlng;

    if (customerMarker) {
      customerMarker.setLatLng(selectedLatLng);
    } else {
      customerMarker = L.marker(selectedLatLng, { icon: customerIcon })
        .addTo(map)
        .bindPopup("âœ… ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„ØµØ­Ø©ØŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªØ³Ø¬Ù‘Ù„ ")
        .openPopup();
    }

    document.getElementById("send-order-button").style.display = "block";
  });

  setTimeout(() => {
    map.invalidateSize();
  }, 300);
}

// âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
function sendWhatsAppOrder() {
  if (document.getElementById("map-container").style.display === "block" && !selectedLatLng) {
    alert("ğŸ›‘ Ù…Ù† ÙØ¶Ù„Ùƒ Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£ÙˆÙ„Ø§Ù‹.");
    return;
  }

  let message = "ğŸ½ï¸ **ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨**\n\n";
  cart.forEach(item => {
    message += `âœ“ ${item.name} Ã—${item.qty}: ${item.price * item.qty} DH\n`;
  });

  message += `\nğŸ’° **Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:** ${cart.reduce((sum, i) => sum + i.price * i.qty, 0)} DH`;

  if (selectedLatLng) {
    message += `\n\nğŸ“ **Ø§Ù„Ù…ÙˆÙ‚Ø¹:** https://www.google.com/maps?q=${selectedLatLng.lat},${selectedLatLng.lng}`;
  }

message += `\n\nğŸŸ Ø´ÙƒØ±Ø§Ù‹ Ø¨Ø²Ø§Ù Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ Ù…Ù† **Smiley Food** â¤ï¸  
Ù†ØªÙ…Ù†Ù‘Ø§Ùˆ Ù„ÙŠÙƒ Ù†ÙƒÙ‡Ø© ØªØ¹Ø¬Ø¨Ùƒ ÙˆØ®Ø¯Ù…Ø© ØªØ±Ø¶ÙŠÙƒ.  
Ø£Ù†Øª Ø¯ÙŠÙ…Ø§ Ù…Ø±Ø­Ù‘Ø¨ Ø¨ÙŠÙƒ Ø¹Ù†Ø¯ Smiley Food ğŸ˜Šâœ¨`;

  const url = "https://wa.me/212600882484?text=" + encodeURIComponent(message);
  window.open(url, "_blank");

  document.getElementById("map-container").style.display = "none";
  document.getElementById("send-order-button").style.display = "none";
}
